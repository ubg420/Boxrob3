var FileLoader={options:{retryCount:4,retryInterval:1e3},request:function(e,n,o,t){if(void 0===n)throw"No method specified";if("responseType"==typeof n)throw"No responseType specified";void 0===t&&(t=0);var r={send:function(){var i=this.onprogress,s=this.onload,a=this.onerror,d=new XMLHttpRequest;d.open(n,e,!0),d.responseType=o,d.onprogress=function(e){i&&i(d,e)},d.onerror=function(e){t!=FileLoader.options.retryCount?(t+=1,setTimeout(r.send.bind(r),FileLoader.options.retryInterval)):a&&a(d,e)},d.onload=function(e){s&&s(d,e)},d.send(null)}};return r},size:function(e,n){var o=FileLoader.request(e,"HEAD","text");o.onerror=function(e,o){n(void 0)},o.onload=function(e,o){if(4===e.readyState)if(200===e.status){var t=e.getResponseHeader("content-length");n(t)}else n(void 0)},o.send()},load:function(e,n,o,t,r,i){var s=FileLoader.request(e,"GET",n);s.onprogress=function(e,n){if(n.lengthComputable)t(n.loaded,n.total);else{var r=e.getResponseHeader("content-length"),i=null!=r?r:o;t(n.loaded,i||n.loaded)}},s.onerror=function(n,o){r("Error loading '"+e+"' ("+o+")")},s.onload=function(o,t){if(4===o.readyState)if(200===o.status){var s=o.response;i("json"==n&&"string"==typeof s?JSON.parse(s):s)}else r("Error loading '"+e+"' ("+t+")")},s.send()}},EngineLoader={wasm_size:2e6,wasmjs_size:25e4,asmjs_size:4e6,stream_wasm:!1,loadAndInstantiateWasmAsync:function(e,n,o,t){FileLoader.load(e,"arraybuffer",EngineLoader.wasm_size,function(e,t){Progress.calculateProgress(n,o,e,t)},function(e){throw e},function(e){Module.instantiateWasm=function(n,o){WebAssembly.instantiate(new Uint8Array(e),n).then(function(e){o(e.instance)}).catch(function(e){throw console.log("wasm instantiation failed! "+e),e});return{}},t()})},setupWasmStreamAsync:async function(e,n,o){var t=fetch;if("function"==typeof TransformStream&&ReadableStream.prototype.pipeThrough){t=async function(e){const t=await fetch(e);var r=t.headers.get("Content-Length");r||(r=EngineLoader.wasm_size);const i=parseInt(r,10);let s=0;const a=new TransformStream({transform(e,t){s+=e.byteLength,Progress.calculateProgress(n,o,s,i),t.enqueue(e)}});return new Response(t.body.pipeThrough(a),t)}}Module.instantiateWasm=function(r,i){return WebAssembly.instantiateStreaming(t(e),r).then(function(e){Progress.calculateProgress(n,o,1,1),i(e.instance)}).catch(function(e){throw console.log("wasm streaming instantiation failed! "+e),e}),{}}},loadWasmAsync:function(e){EngineLoader.stream_wasm&&"function"==typeof WebAssembly.instantiateStreaming?(EngineLoader.setupWasmStreamAsync(e+".wasm",10,50),EngineLoader.loadAndRunScriptAsync(e+"_wasm.js",EngineLoader.wasmjs_size,0,10)):EngineLoader.loadAndInstantiateWasmAsync(e+".wasm",0,40,function(){EngineLoader.loadAndRunScriptAsync(e+"_wasm.js",EngineLoader.wasmjs_size,40,50)})},loadAsmJsAsync:function(e){EngineLoader.loadAndRunScriptAsync(e+"_asmjs.js",EngineLoader.asmjs_size,0,50)},loadAndRunScriptAsync:function(e,n,o,t){FileLoader.load(e,"text",n,function(e,n){Progress.calculateProgress(o,t,e,n)},function(e){throw e},function(e){var n=document.createElement("script");n.text=e,document.body.appendChild(n)})},load:function(e,n){Progress.addProgress(Module.setupCanvas(e)),Module.isWASMSupported?EngineLoader.loadWasmAsync(n):EngineLoader.loadAsmJsAsync(n)}},GameArchiveLoader={_files:[],_fileIndex:0,isCompleted:!1,_onFileLoadedListeners:[],_onArchiveLoadedListeners:[],_onFileDownloadErrorListeners:[],_currentDownloadBytes:0,_totalDownloadBytes:0,_archiveLocationFilter:function(e){return"split"+e},cleanUp:function(){this._files=[],this._fileIndex=0,this.isCompleted=!1,this._onGameArchiveLoaderCompletedListeners=[],this._onAllTargetsBuiltListeners=[],this._onFileDownloadErrorListeners=[],this._currentDownloadBytes=0,this._totalDownloadBytes=0},addListener:function(e,n){if("function"!=typeof n)throw"Invalid callback registration";e.push(n)},notifyListeners:function(e,n){for(i=0;i<e.length;++i)e[i](n)},addFileDownloadErrorListener:function(e){this.addListener(this._onFileDownloadErrorListeners,e)},notifyFileDownloadError:function(e){this.notifyListeners(this._onFileDownloadErrorListeners,e)},addFileLoadedListener:function(e){this.addListener(this._onFileLoadedListeners,e)},notifyFileLoaded:function(e){this.notifyListeners(this._onFileLoadedListeners,{name:e.name,data:e.data})},addArchiveLoadedListener:function(e){this.addListener(this._onArchiveLoadedListeners,e)},notifyArchiveLoaded:function(){this.notifyListeners(this._onArchiveLoadedListeners)},setFileLocationFilter:function(e){if("function"!=typeof e)throw"Invalid filter";this._archiveLocationFilter=e},loadArchiveDescription:function(e){FileLoader.load(this._archiveLocationFilter(e),"json",void 0,function(e,n){},function(n){GameArchiveLoader.notifyFileDownloadError(e)},function(e){GameArchiveLoader.onReceiveDescription(e)})},onReceiveDescription:function(e){this._files=e.content,this._totalDownloadBytes=0,this._currentDownloadBytes=0;for(var n=0;n<this._files.length;++n)this._totalDownloadBytes+=this._files[n].size;this.downloadContent()},downloadContent:function(){var e=this._files[this._fileIndex];e.pieces.length>1&&(e.data=new Uint8Array(e.size));var n=e.pieces.length;void 0!==this.MAX_CONCURRENT_XHR&&(n=Math.min(n,this.MAX_CONCURRENT_XHR));for(var o=0;o<n;++o)this.downloadPiece(e,o)},notifyDownloadProgress:function(){Progress.calculateProgress(50,100,this._currentDownloadBytes,this._totalDownloadBytes)},downloadPiece:function(e,n){if(n<e.lastRequestedPiece)throw"Request out of order";var o=e.pieces[n];e.lastRequestedPiece=n,e.totalLoadedPieces=0;var t=0,r=this._archiveLocationFilter("/"+o.name);FileLoader.load(r,"arraybuffer",void 0,function(e,n){var o=e-t;t=e,GameArchiveLoader._currentDownloadBytes+=o,GameArchiveLoader.notifyDownloadProgress()},function(e){GameArchiveLoader.notifyFileDownloadError(e)},function(n){o.data=new Uint8Array(n),o.dataLength=o.data.length,o.dataLength,t=o.dataLength,GameArchiveLoader.onPieceLoaded(e,o),GameArchiveLoader.notifyDownloadProgress(),o.data=void 0})},addPieceToFile:function(e,n){if(1==e.pieces.length)e.data=n.data;else{var o=n.offset,t=o+n.data.length;if(0>o)throw"Buffer underflow";if(t>e.data.length)throw"Buffer overflow";e.data.set(n.data,n.offset)}},onPieceLoaded:function(e,n){if(this.addPieceToFile(e,n),++e.totalLoadedPieces,e.totalLoadedPieces==e.pieces.length)this.onFileLoaded(e);else{var o=e.lastRequestedPiece+1;o<e.pieces.length&&this.downloadPiece(e,o)}},verifyFile:function(e){for(var n=0,o=0;o<e.pieces.length;++o)n+=e.pieces[o].dataLength;if(e.pieces.length>1){e.data;var t=e.pieces;for(o=0;o<t.length;++o){var r=t[o],i=r.offset,s=i+r.dataLength;if(0<o){var a=t[o-1];if(a.offset+a.dataLength>i)throw"Segment underflow"}if(t.length-2>o)if(s>t[o+1].offset)throw"Segment overflow"}}},onFileLoaded:function(e){this.verifyFile(e),this.notifyFileLoaded(e),++this._fileIndex,this._fileIndex==this._files.length?this.onArchiveLoaded():this.downloadContent()},onArchiveLoaded:function(){this.isCompleted=!0,this.notifyArchiveLoaded()}},Progress={progress_id:"defold-progress",bar_id:"defold-progress-bar",listeners:[],addListener:function(e){if("function"!=typeof e)throw"Invalid callback registration";this.listeners.push(e)},notifyListeners:function(e){for(i=0;i<this.listeners.length;++i)this.listeners[i](e)},addProgress:function(e){e.insertAdjacentHTML("afterend",'<div id="'+Progress.progress_id+'" class="canvas-app-progress"><div id="'+Progress.bar_id+'" class="canvas-app-progress-bar" style="width: 0%;"></div></div>'),Progress.bar=document.getElementById(Progress.bar_id),Progress.progress=document.getElementById(Progress.progress_id)},updateProgress:function(e){Progress.bar&&(Progress.bar.style.width=Math.min(e,100)+"%"),Progress.notifyListeners(e)},calculateProgress:function(e,n,o,t){this.updateProgress(e+o/t*(n-e))},removeProgress:function(){null!==Progress.progress.parentElement&&(Progress.progress.parentElement.removeChild(Progress.progress),Module.canvas.style.background="")}},Module={noInitialRun:!0,_filesToPreload:[],_archiveLoaded:!1,_preLoadDone:!1,_waitingForArchive:!1,persistentStorage:!0,_syncInProgress:!1,_syncNeeded:!1,_syncInitial:!1,_syncMaxTries:3,_syncTries:0,arguments:[],print:function(e){console.log(e)},printErr:function(e){console.error(e)},setStatus:function(e){console.log(e)},isWASMSupported:function(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e)instanceof WebAssembly.Instance}}catch(e){}return!1}(),prepareErrorObject:function(e,n,o,t,r){var i=(n=void 0===n?"":n)+":"+(o=void 0===o?0:o)+":"+(t=void 0===t?0:t),s=r||(void 0!==window.event?window.event.error:"")||e||"Undefined Error",a="",d="";"object"==typeof s&&void 0!==s.stack&&void 0!==s.message?(d=String(s.stack),a=String(s.message)):(a=(d=String(s).split("\n")).shift(),d=d.join("\n")),d=d||i;var l=/at (\S+:\d*$)/.exec(a);return l&&(a=a.replace(/(at \S+:\d*$)/,""),d=l[1]+"\n"+d),a=a.replace(/(abort\(.+\)) at .+/,"$1"),{stack:d=(d=(d=(d=(d=d.replace(/\?{1}\S+(:\d+:\d+)/g,"$1")).replace(/ *at (\S+)$/gm,"@$1")).replace(/ *at (\S+)(?: \[as \S+\])? +\((.+)\)/g,"$1@$2")).replace(/^((?:Object|Array)\.)/gm,"")).split("\n"),message:a}},hasWebGLSupport:function(){var e=!1;try{var n=document.createElement("canvas"),o=n.getContext("webgl")||n.getContext("experimental-webgl");o&&o instanceof WebGLRenderingContext&&(e=!0)}catch(n){console.log("An error occurred while detecting WebGL support: "+n),e=!1}return e},setupCanvas:function(e){return e=void 0===e?"canvas":e,Module.canvas=document.getElementById(e),Module.canvas},runApp:function(e,n){Module.setupCanvas(e);var o={archive_location_filter:function(e){return"split"+e},unsupported_webgl_callback:void 0,engine_arguments:[],persistent_storage:!0,custom_heap_size:void 0,disable_context_menu:!0,retry_time:1,retry_count:10,can_not_download_file_callback:void 0};for(var t in n)n.hasOwnProperty(t)&&(o[t]=n[t]);Module.arguments=o.engine_arguments,Module.persistentStorage=o.persistent_storage;var r=o.full_screen_container;"string"==typeof r&&(r=document.querySelector(r)),Module.fullScreenContainer=r||Module.canvas,Module.hasWebGLSupport()?(Module.canvas.focus(),o.disable_context_menu&&(Module.canvas.oncontextmenu=function(e){e.preventDefault()}),FileLoader.options.retryCount=o.retry_count,FileLoader.options.retryInterval=1e3*o.retry_time,"function"==typeof o.can_not_download_file_callback&&GameArchiveLoader.addFileDownloadErrorListener(o.can_not_download_file_callback),GameArchiveLoader.addFileLoadedListener(Module.onArchiveFileLoaded),GameArchiveLoader.addArchiveLoadedListener(Module.onArchiveLoaded),GameArchiveLoader.setFileLocationFilter(o.archive_location_filter),GameArchiveLoader.loadArchiveDescription("/archive_files.json")):(Progress.updateProgress(100,"Unable to start game, WebGL not supported"),Module.setStatus=function(e){e&&Module.printErr("[missing WebGL] "+e)},"function"==typeof o.unsupported_webgl_callback&&o.unsupported_webgl_callback())},onArchiveFileLoaded:function(e){Module._filesToPreload.push({path:e.name,data:e.data})},onArchiveLoaded:function(){GameArchiveLoader.cleanUp(),Module._archiveLoaded=!0,Progress.updateProgress(100,"Starting..."),Module._waitingForArchive&&Module._preloadAndCallMain()},toggleFullscreen:function(e){GLFW.isFullscreen?GLFW.cancelFullScreen():GLFW.requestFullScreen(e)},preSync:function(e){if(1!=Module.persistentStorage)return Module._syncInitial=!0,void e();FS.syncfs(!0,function(n){n?(Module._syncTries+=1,console.warn("Unable to synchronize mounted file systems: "+n),Module._syncMaxTries>Module._syncTries?Module.preSync(e):(Module._syncInitial=!0,e())):(Module._syncInitial=!0,void 0!==e&&e())})},preloadAll:function(){if(!Module._preLoadDone){Module._preLoadDone=!0;for(var e=0;e<Module._filesToPreload.length;++e){var n=Module._filesToPreload[e];FS.createPreloadedFile("",n.path,n.data,!0,!0)}}},persistentSync:function(){1==Module.persistentStorage&&Module._syncInitial&&(Module._syncInProgress?Module._syncNeeded=!0:Module._startSyncFS())},preInit:[function(){var e=DMSYS.GetUserPersistentDataRoot();try{FS.mkdir(e)}catch(e){return Module.persistentStorage=!1,void Module._preloadAndCallMain()}try{FS.mount(IDBFS,{},e);var n=FS.close;FS.close=function(e){var o=n(e);return Module.persistentSync(),o}}catch(e){return Module.persistentStorage=!1,void Module._preloadAndCallMain()}Module.preSync(function(){Module._preloadAndCallMain()})}],preRun:[function(){Module._archiveLoaded&&Module.preloadAll()}],postRun:[function(){Module._archiveLoaded&&Progress.removeProgress()}],_preloadAndCallMain:function(){Module._archiveLoaded?(Module.preloadAll(),Progress.removeProgress(),void 0===Module.callMain?Module.noInitialRun=!1:Module.callMain(Module.arguments)):Module._waitingForArchive=!0},_startSyncFS:function(){Module._syncInProgress=!0,Module._syncMaxTries>Module._syncTries&&FS.syncfs(!1,function(e){Module._syncInProgress=!1,e&&(console.warn("Unable to synchronize mounted file systems: "+e),Module._syncTries+=1),Module._syncNeeded&&(Module._syncNeeded=!1,Module._startSyncFS())})}};window.onerror=function(e,n,o,t,r){if(void 0!==Module.ccall){var i=Module.prepareErrorObject(e,n,o,t,r);Module.ccall("JSWriteDump","null",["string"],[JSON.stringify(i.stack)])}Module.setStatus("Exception thrown, see JavaScript console"),Module.setStatus=function(e){e&&Module.printErr("[post-exception status] "+e)}};